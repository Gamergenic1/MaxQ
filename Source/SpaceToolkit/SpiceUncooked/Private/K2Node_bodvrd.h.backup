// Copyright 2021 Gamergenic.  See full copyright notice in Spice.h.
// Author: chucknoble@gamergenic.com | https://www.gamergenic.com
// 
// Implementation of:
// "Adding Third-Party Libraries to Unreal Engine : NASA's SPICE Toolkit"
// https://gamedevtricks.com/post/third-party-libs-1/

#pragma once

#include "CoreMinimal.h"
#include "K2Node.h"
#include "SpiceTypes.h"
#include "K2Type.h"
#include "K2Conversion.h"
#include "K2OperationNOutput.h"
#include "K2Node_bodvrd.generated.h"

#pragma once

UCLASS(BlueprintType, Blueprintable)
class SPICEUNCOOKED_API UK2Node_bodvrd : public UK2Node
{
    GENERATED_BODY()

private:
    const FName bodynm_Field = FName(TEXT("bodynm"));
    const FName item_Field = FName(TEXT("item"));
    const FName value_Field = FName(TEXT("Value"));
    const FName success_Field = FName(TEXT("Success"));
    const FName error_Field = FName(TEXT("Error"));
    const FName errorMessage_Field = FName(TEXT("ErrorMessage"));

    const FName bodynm_DefaultValue = FName(TEXT("EARTH"));
    const FName item_DefaultValue = FName(TEXT("RADII"));

private:
    bool CheckForErrors(FKismetCompilerContext& CompilerContext);
    TMap<FName, FK2OperationNOutput> OperationsMap;
    static FK2OperationNOutput WildcardOp();
    static FK2OperationNOutput DoubleOp();
    static FK2OperationNOutput ArrayDoubleOp();
    static FK2OperationNOutput SDimensionlessVectorOp();
    static FK2OperationNOutput SMassConstantOp();
    static FK2OperationNOutput SDistanceOp();
    static FK2OperationNOutput SDegreesOp();
    static FK2OperationNOutput SDistanceVectorOp();
    static FK2OperationNOutput SVelocityVectorOp();

public:

    UPROPERTY() FString bodynm_Value;
    UPROPERTY() FString item_Value;
    UPROPERTY() FString value_Value;

    UPROPERTY()
    TObjectPtr<UScriptStruct> StructType;

    UPROPERTY()
    FK2OperationNOutput CurrentOperation;

    UK2Node_bodvrd();

public:

    bool IsNodeSafeToIgnore() const;
    void GetMenuActions(FBlueprintActionDatabaseRegistrar& ActionRegistrar) const;
    FText GetMenuCategory() const;
    FText GetNodeTitle(ENodeTitleType::Type TitleType) const;
    FText GetTooltipText() const;
    FText GetKeywords() const;
    
    void AllocateDefaultPins();
    void ExpandNode(FKismetCompilerContext& CompilerContext, UEdGraph* SourceGraph);
    bool IsConnectionDisallowed(const UEdGraphPin* MyPin, const UEdGraphPin* OtherPin, FString& OutReason) const;
    bool IsOutputCompatible(const UEdGraphPin* ThePin) const;
    void NotifyPinConnectionListChanged(UEdGraphPin* Pin);
    void ReconstructNode();

    UEdGraphPin* bodynmPin() const { return FindPinChecked(bodynm_Field); }
    UEdGraphPin* itemPin() const { return FindPinChecked(item_Field); }
    UEdGraphPin* successPin() const { return FindPinChecked(success_Field); }
    UEdGraphPin* errorPin() const { return FindPinChecked(error_Field); }
    UEdGraphPin* errorMessagePin() const { return FindPinChecked(errorMessage_Field); }
    UEdGraphPin* returnValuePin() const { return FindPinChecked(value_Field); }
    UEdGraphPin* getReturnValuePin(class UK2Node_CallFunction* other) const;
};


